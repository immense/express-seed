<!DOCTYPE html><html lang="en"><head><title>Gruntfile</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content=""><meta name="groc-document-path" content="Gruntfile"><meta name="groc-project-path" content="Gruntfile.coffee"><link rel="stylesheet" type="text/css" media="all" href="assets/style.css"><script type="text/javascript" src="assets/behavior.js"></script><body><div id="meta"><div class="file-path">Gruntfile.coffee</div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="nv">fs = </span><span class="nx">require</span> <span class="s">&#39;fs&#39;</span>

<span class="k">if</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">existsSync</span> <span class="s">&#39;./app/config/app.coffee&#39;</span>
  <span class="nv">config = </span><span class="nx">require</span> <span class="s">&#39;./app/config/app&#39;</span>

<span class="nv">module.exports = </span><span class="nf">(grunt) -&gt;</span>
  <span class="nx">grunt</span><span class="p">.</span><span class="nx">initConfig</span> <span class="p">{</span>

    <span class="nv">groc:</span>
      <span class="nv">javascript: </span><span class="p">[</span>
        <span class="s">&quot;**/*.coffee&quot;</span>
        <span class="s">&quot;README.md&quot;</span>
      <span class="p">],</span>
      <span class="nv">options:</span>
        <span class="nv">out: </span><span class="s">&quot;doc/&quot;</span>
        <span class="nv">except: </span><span class="p">[</span>
          <span class="s">&quot;node_modules/**/*&quot;</span>
          <span class="s">&quot;bower_components/**/*&quot;</span>
          <span class="s">&quot;app/config/app.coffee&quot;</span>
          <span class="s">&quot;app/config/logger.coffee&quot;</span>
          <span class="s">&quot;app/config/mongo.coffee&quot;</span>
          <span class="s">&quot;app/config/nginx.coffee&quot;</span>
        <span class="p">]</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>clean up compiled or temporary files</p></div></div><div class="code"><div class="wrapper">    <span class="nv">clean:</span>
      <span class="nv">pre: </span><span class="p">[</span><span class="s">&#39;public/*&#39;</span><span class="p">]</span>
      <span class="nv">pre_images: </span><span class="p">[</span><span class="s">&#39;public/img/*&#39;</span><span class="p">]</span>
      <span class="nv">post: </span><span class="p">[</span><span class="s">&#39;tmp/*&#39;</span><span class="p">]</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>copy static assets into public/</p></div></div><div class="code"><div class="wrapper">    <span class="nv">copy:</span>
      <span class="nv">images:</span>
        <span class="nv">expand: </span><span class="kc">true</span>
        <span class="nv">cwd: </span><span class="s">&#39;assets/img/&#39;</span>
        <span class="nv">src: </span><span class="s">&#39;**&#39;</span>
        <span class="nv">dest: </span><span class="s">&#39;public/img/&#39;</span>
      <span class="nv">fontAwesome:</span>
        <span class="nv">expand: </span><span class="kc">true</span>
        <span class="nv">cwd: </span><span class="s">&#39;bower_components/font-awesome/fonts/&#39;</span>
        <span class="nv">src: </span><span class="s">&#39;*&#39;</span>
        <span class="nv">dest: </span><span class="s">&#39;public/fonts/&#39;</span>
      <span class="nv">glyphIcons:</span>
        <span class="nv">expand: </span><span class="kc">true</span>
        <span class="nv">cwd: </span><span class="s">&#39;bower_components/bootstrap/fonts/&#39;</span>
        <span class="nv">src: </span><span class="s">&#39;*&#39;</span>
        <span class="nv">dest: </span><span class="s">&#39;public/fonts/&#39;</span>

    <span class="nv">jade:</span>
      <span class="nv">compile:</span>
        <span class="nv">files:</span>
          <span class="s">&#39;public/502.html&#39;</span><span class="o">:</span> <span class="s">&#39;app/views/errors/502.jade&#39;</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>compile coffeescript files</p></div></div><div class="code"><div class="wrapper">    <span class="nv">coffee:</span>
      <span class="nv">glob_to_multiple:</span>
        <span class="nv">expand: </span><span class="kc">true</span>
        <span class="nv">cwd: </span><span class="s">&#39;assets/scripts/&#39;</span>
        <span class="nv">src: </span><span class="p">[</span><span class="s">&#39;**/*.coffee&#39;</span><span class="p">]</span>
        <span class="nv">dest: </span><span class="s">&#39;tmp/coffee_output/&#39;</span>
        <span class="nv">ext: </span><span class="s">&#39;.js&#39;</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>compile less files</p></div></div><div class="code"><div class="wrapper">    <span class="nv">less:</span>
      <span class="nv">app:</span>
        <span class="nv">options:</span>
          <span class="nv">paths: </span><span class="p">[</span>
            <span class="s">&#39;bower_components/bootstrap/less&#39;</span>
            <span class="s">&#39;bower_components/font-awesome/less&#39;</span>
          <span class="p">]</span>
          <span class="nv">compress: </span><span class="nx">config</span><span class="o">?</span><span class="p">.</span><span class="nx">env</span> <span class="o">is</span> <span class="s">&#39;production&#39;</span>
        <span class="nv">files:</span>
          <span class="s">&#39;tmp/less_output/app.css&#39;</span><span class="o">:</span> <span class="s">&#39;assets/styles/app.less&#39;</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>concatenate js files</p></div></div><div class="code"><div class="wrapper">    <span class="nv">concat:</span>
      <span class="nv">options:</span>
        <span class="nv">separator: </span><span class="s">&#39;;&#39;</span>
      <span class="nv">compat_js:</span>
        <span class="nv">src: </span><span class="p">[</span>
          <span class="s">&#39;bower_components/modernizr/modernizr.js&#39;</span>
          <span class="s">&#39;bower_components/respond/dest/respond.src.js&#39;</span>
          <span class="s">&#39;bower_components/es5-shim/es5-shim.js&#39;</span>
        <span class="p">]</span>
        <span class="nv">dest: </span><span class="s">&#39;public/js/compat.js&#39;</span>
      <span class="nv">app_js:</span>
        <span class="nv">src: </span><span class="p">[</span>
          <span class="s">&#39;bower_components/sugar/release/sugar.min.js&#39;</span>
          <span class="s">&#39;bower_components/jquery/dist/jquery.js&#39;</span>
          <span class="s">&#39;bower_components/bootstrap/dist/js/bootstrap.js&#39;</span>
          <span class="s">&#39;bower_components/knockout.js/knockout.js&#39;</span>

          <span class="s">&#39;tmp/coffee_output/shoutout.js&#39;</span>
        <span class="p">]</span>
        <span class="nv">dest: </span><span class="s">&#39;public/js/app.js&#39;</span>
      <span class="nv">app_css:</span>
        <span class="nv">options:</span>
          <span class="nv">separator: </span><span class="s">&#39;\n&#39;</span>
        <span class="nv">src: </span><span class="p">[</span>
          <span class="s">&#39;tmp/less_output/app.css&#39;</span>
        <span class="p">]</span>
        <span class="nv">dest: </span><span class="s">&#39;public/css/app.css&#39;</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>uglifyjs files</p></div></div><div class="code"><div class="wrapper">    <span class="nv">uglify:</span>
      <span class="nv">compat:</span>
        <span class="nv">src: </span><span class="s">&#39;public/js/compat.js&#39;</span>
        <span class="nv">dest: </span><span class="s">&#39;public/js/compat.js&#39;</span>
      <span class="nv">app:</span>
        <span class="nv">src: </span><span class="s">&#39;public/js/app.js&#39;</span>
        <span class="nv">dest: </span><span class="s">&#39;public/js/app.js&#39;</span>

    <span class="nv">watch:</span>
      <span class="nv">scripts:</span>
        <span class="nv">files: </span><span class="p">[</span><span class="s">&#39;assets/scripts/**/*.coffee&#39;</span><span class="p">]</span>
        <span class="nv">tasks: </span><span class="p">[</span><span class="s">&#39;coffee&#39;</span><span class="p">,</span> <span class="s">&#39;concat:app_js&#39;</span><span class="p">,</span> <span class="s">&#39;clean:post&#39;</span><span class="p">]</span>

      <span class="nv">styles:</span>
        <span class="nv">files: </span><span class="p">[</span><span class="s">&#39;assets/styles/**/*.less&#39;</span><span class="p">]</span>
        <span class="nv">tasks: </span><span class="p">[</span><span class="s">&#39;less&#39;</span><span class="p">,</span> <span class="s">&#39;concat:app_css&#39;</span><span class="p">,</span> <span class="s">&#39;clean:post&#39;</span><span class="p">]</span>

      <span class="nv">images:</span>
        <span class="nv">files: </span><span class="p">[</span><span class="s">&#39;assets/img/**&#39;</span><span class="p">]</span>
        <span class="nv">tasks: </span><span class="p">[</span><span class="s">&#39;clean:pre_images&#39;</span><span class="p">,</span> <span class="s">&#39;copy:images&#39;</span><span class="p">]</span>

      <span class="nv">badGateway:</span>
        <span class="nv">files: </span><span class="p">[</span><span class="s">&#39;app/views/errors/502.jade&#39;</span><span class="p">]</span>
        <span class="nv">tasks: </span><span class="p">[</span><span class="s">&#39;jade&#39;</span><span class="p">]</span>

      <span class="nv">templates:</span>
        <span class="nv">files: </span><span class="p">[</span><span class="s">&#39;app/views/**&#39;</span><span class="p">]</span>
        <span class="nv">options: livereload: </span><span class="kc">true</span>

      <span class="nv">livereload:</span>
        <span class="nv">files: </span><span class="p">[</span><span class="s">&#39;public/**/*&#39;</span><span class="p">]</span>
        <span class="nv">options: livereload: </span><span class="kc">true</span>

      <span class="nv">gruntfile:</span>
        <span class="nv">files: </span><span class="p">[</span><span class="s">&#39;Gruntfile.coffee&#39;</span><span class="p">]</span>
        <span class="nv">tasks: </span><span class="p">[</span><span class="s">&#39;deploy-assets&#39;</span><span class="p">]</span>

      <span class="nv">npm:</span>
        <span class="nv">files: </span><span class="p">[</span><span class="s">&#39;package.json&#39;</span><span class="p">]</span>
        <span class="nv">tasks: </span><span class="p">[</span><span class="s">&#39;shell:npm&#39;</span><span class="p">]</span>

      <span class="nv">bower:</span>
        <span class="nv">files: </span><span class="p">[</span><span class="s">&#39;bower.json&#39;</span><span class="p">]</span>
        <span class="nv">tasks: </span><span class="p">[</span><span class="s">&#39;shell:bower&#39;</span><span class="p">]</span>

    <span class="nv">nodemon:</span>
      <span class="nv">dev:</span>
        <span class="nv">script: </span><span class="s">&#39;app/index.coffee&#39;</span>
        <span class="nv">options:</span>
          <span class="nv">watch: </span><span class="p">[</span><span class="s">&#39;app&#39;</span><span class="p">,</span> <span class="s">&#39;node_modules&#39;</span><span class="p">]</span>

    <span class="nv">forever:</span>
      <span class="nv">options:</span>
        <span class="nv">index: </span><span class="s">&#39;app/index.coffee&#39;</span>
        <span class="nv">logDir: </span><span class="s">&#39;log&#39;</span>
        <span class="nv">logFile: </span><span class="s">&#39;forever.log&#39;</span>
        <span class="nv">errFile: </span><span class="s">&#39;forever-err.log&#39;</span>
        <span class="nv">command: </span><span class="s">&#39;./node_modules/.bin/coffee&#39;</span>

    <span class="nv">concurrent:</span>
      <span class="nv">dev:</span>
        <span class="nv">tasks: </span><span class="p">[</span><span class="s">&#39;nodemon:dev&#39;</span><span class="p">,</span> <span class="s">&#39;watch&#39;</span><span class="p">]</span>
        <span class="nv">options:</span>
          <span class="nv">logConcurrentOutput: </span><span class="kc">true</span>

    <span class="nv">shell:</span>
      <span class="nv">copyConfigs:</span>
        <span class="nv">options:</span>
          <span class="nv">stdout: </span><span class="kc">true</span>
          <span class="nv">stderr: </span><span class="kc">true</span>
        <span class="nv">command: </span><span class="s">&quot;&quot;&quot;</span>
<span class="s">          cp app/config/app.sample.coffee app/config/app.coffee</span>
<span class="s">          cp app/config/logger.sample.coffee app/config/logger.coffee</span>
<span class="s">          cp app/config/mongo.sample.coffee app/config/mongo.coffee</span>
<span class="s">          cp app/config/nginx.sample.coffee app/config/nginx.coffee</span>
<span class="s">        &quot;&quot;&quot;</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>this task must be run as root</p></div></div><div class="code"><div class="wrapper">      <span class="nv">activateService:</span>
        <span class="nv">options:</span>
          <span class="nv">stdout: </span><span class="kc">true</span>
          <span class="nv">stderr: </span><span class="kc">true</span>
        <span class="nv">command: </span><span class="k">if</span> <span class="nx">config</span><span class="o">?</span> <span class="k">then</span> <span class="s">&quot;chkconfig </span><span class="si">#{</span><span class="nx">config</span><span class="p">.</span><span class="nx">appName</span><span class="si">}</span><span class="s"> on&quot;</span> <span class="k">else</span> <span class="s">&quot;echo &#39;no config file&#39;&quot;</span>
      <span class="nv">npm:</span>
        <span class="nv">options:</span>
          <span class="nv">stdout: </span><span class="kc">true</span>
          <span class="nv">stderr: </span><span class="kc">true</span>
        <span class="nv">command: </span><span class="s">&#39;npm prune &amp;&amp; npm install&#39;</span>
      <span class="nv">bower:</span>
        <span class="nv">options:</span>
          <span class="nv">stdout: </span><span class="kc">true</span>
          <span class="nv">stderr: </span><span class="kc">true</span>
        <span class="nv">command: </span><span class="s">&#39;bower prune &amp;&amp; bower install&#39;</span>
  <span class="p">}</span>

  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span> <span class="s">&#39;grunt-contrib-concat&#39;</span>
  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span> <span class="s">&#39;grunt-contrib-uglify&#39;</span>
  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span> <span class="s">&#39;grunt-contrib-coffee&#39;</span>
  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span> <span class="s">&#39;grunt-contrib-less&#39;</span>
  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span> <span class="s">&#39;grunt-contrib-clean&#39;</span>
  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span> <span class="s">&#39;grunt-contrib-copy&#39;</span>
  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span> <span class="s">&#39;grunt-contrib-watch&#39;</span>
  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span> <span class="s">&#39;grunt-contrib-jade&#39;</span>
  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span> <span class="s">&#39;grunt-nodemon&#39;</span>
  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span> <span class="s">&#39;grunt-concurrent&#39;</span>
  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span> <span class="s">&#39;grunt-forever&#39;</span>
  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span> <span class="s">&#39;grunt-shell&#39;</span>
  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span> <span class="s">&#39;grunt-groc&#39;</span>

  <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span> <span class="s">&#39;deploy-assets&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s">&#39;clean:pre&#39;</span>
    <span class="s">&#39;copy&#39;</span>
    <span class="s">&#39;less&#39;</span>
    <span class="s">&#39;coffee&#39;</span>
    <span class="s">&#39;concat&#39;</span>
    <span class="s">&#39;jade&#39;</span>
    <span class="s">&#39;clean:post&#39;</span>
  <span class="p">]</span>

  <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span> <span class="s">&#39;setup&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;shell:copyConfigs&#39;</span><span class="p">]</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>this task must be run as root</p></div></div><div class="code"><div class="wrapper">  <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span> <span class="s">&#39;setup-service&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">config</span><span class="o">?</span> <span class="k">then</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&#39;no app.coffee config file.&#39;</span>
    <span class="nv">filename = </span><span class="nx">config</span><span class="p">.</span><span class="nx">appName</span>
    <span class="nv">username = </span><span class="nx">config</span><span class="p">.</span><span class="nx">appUser</span>
    <span class="nv">Mustache = </span><span class="nx">require</span> <span class="s">&#39;mustache&#39;</span>
    <span class="nv">done = </span><span class="nx">@async</span><span class="p">()</span>

    <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span> <span class="s">&#39;./support/init.sh&#39;</span><span class="p">,</span> <span class="nf">(err, initScriptContents) -&gt;</span>
      <span class="k">if</span> <span class="nx">err</span><span class="o">?</span> <span class="k">then</span> <span class="k">throw</span> <span class="nx">err</span>

      <span class="nv">output = </span><span class="nx">Mustache</span><span class="p">.</span><span class="nx">render</span> <span class="nx">initScriptContents</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span> <span class="nv">applicationName: </span><span class="nx">config</span><span class="p">.</span><span class="nx">appName</span><span class="p">,</span> <span class="nv">applicationUser: </span><span class="nx">username</span>
      <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFile</span> <span class="s">&quot;/etc/init.d/</span><span class="si">#{</span><span class="nx">filename</span><span class="si">}</span><span class="s">&quot;</span><span class="p">,</span> <span class="nx">output</span><span class="p">,</span> <span class="nf">(err) -&gt;</span>
        <span class="k">if</span> <span class="nx">err</span><span class="o">?</span> <span class="k">then</span> <span class="k">throw</span> <span class="nx">err</span>
        <span class="nx">fs</span><span class="p">.</span><span class="nx">chmod</span> <span class="s">&quot;/etc/init.d/</span><span class="si">#{</span><span class="nx">filename</span><span class="si">}</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&#39;755&#39;</span><span class="p">,</span> <span class="nf">(err) -&gt;</span>
          <span class="k">if</span> <span class="nx">err</span><span class="o">?</span> <span class="k">then</span> <span class="k">throw</span> <span class="nx">err</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;init script written to /etc/init.d/</span><span class="si">#{</span><span class="nx">filename</span><span class="si">}</span><span class="s">&quot;</span>
          <span class="nx">grunt</span><span class="p">.</span><span class="nx">task</span><span class="p">.</span><span class="nx">run</span> <span class="s">&#39;shell:activateService&#39;</span>
          <span class="nx">done</span><span class="p">()</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>this task must be run as root</p></div></div><div class="code"><div class="wrapper">  <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span> <span class="s">&#39;setup-nginx&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
    <span class="k">if</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">existsSync</span> <span class="s">&#39;./app/config/nginx.coffee&#39;</span>
      <span class="nv">nginx_config = </span><span class="nx">require</span> <span class="s">&#39;./app/config/nginx&#39;</span>

    <span class="k">if</span> <span class="o">not</span> <span class="nx">nginx_config</span><span class="o">?</span> <span class="k">then</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&#39;no nginx.coffee config file.&#39;</span>
    <span class="nv">upstreamName = </span><span class="nx">nginx_config</span><span class="p">.</span><span class="nx">upstreamName</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">upstreamName</span><span class="o">?</span> <span class="k">then</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&#39;no upstreamName defined in app.coffee.&#39;</span>
    <span class="nv">socketFile = </span><span class="nx">nginx_config</span><span class="p">.</span><span class="nx">socketFile</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">socketFile</span><span class="o">?</span> <span class="k">then</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&#39;not configured to run on a unix socket.&#39;</span>
    <span class="nv">serverNames = </span><span class="nx">nginx_config</span><span class="p">.</span><span class="nx">serverNames</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">serverNames</span><span class="o">?</span> <span class="k">then</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&#39;no serverNames defined in app.coffee.&#39;</span>
    <span class="nv">publicRoot = </span><span class="nx">nginx_config</span><span class="p">.</span><span class="nx">publicRoot</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">publicRoot</span><span class="o">?</span> <span class="k">then</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&#39;no publicRoot defined in app.coffee.&#39;</span>
    <span class="nv">confPath = </span><span class="nx">nginx_config</span><span class="p">.</span><span class="nx">confPath</span>
    <span class="k">if</span> <span class="o">not</span> <span class="nx">confPath</span><span class="o">?</span> <span class="k">then</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&#39;no confPath defined in app.coffee.&#39;</span>
    <span class="nv">Mustache = </span><span class="nx">require</span> <span class="s">&#39;mustache&#39;</span>
    <span class="nv">done = </span><span class="nx">@async</span><span class="p">()</span>

    <span class="nv">locals =</span>
      <span class="nv">upstreamName: </span><span class="nx">upstreamName</span>
      <span class="nv">socketFile: </span><span class="nx">socketFile</span>
      <span class="nv">serverNames: </span><span class="nx">serverNames</span>
      <span class="nv">publicRoot: </span><span class="nx">publicRoot</span>

    <span class="nv">filename = </span><span class="nx">config</span><span class="p">.</span><span class="nx">appName</span>

    <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span> <span class="s">&#39;./support/nginx.conf&#39;</span><span class="p">,</span> <span class="nf">(err, configContents) -&gt;</span>
      <span class="k">if</span> <span class="nx">err</span><span class="o">?</span> <span class="k">then</span> <span class="k">throw</span> <span class="nx">err</span>

      <span class="nv">output = </span><span class="nx">Mustache</span><span class="p">.</span><span class="nx">render</span> <span class="nx">configContents</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span> <span class="nx">locals</span>
      <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFile</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">confPath</span><span class="si">}</span><span class="s">/</span><span class="si">#{</span><span class="nx">filename</span><span class="si">}</span><span class="s">&quot;</span><span class="p">,</span> <span class="nx">output</span><span class="p">,</span> <span class="nf">(err) -&gt;</span>
        <span class="k">if</span> <span class="nx">err</span><span class="o">?</span> <span class="k">then</span> <span class="k">throw</span> <span class="nx">err</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;nginx vhost config file written to </span><span class="si">#{</span><span class="nx">confPath</span><span class="si">}</span><span class="s">/</span><span class="si">#{</span><span class="nx">filename</span><span class="si">}</span><span class="s">&quot;</span>
        <span class="nx">done</span><span class="p">()</span>

  <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span> <span class="s">&#39;db:seed&#39;</span><span class="p">,</span> <span class="s">&#39;Seeds the database&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
    <span class="nv">User = </span><span class="nx">require</span> <span class="s">&#39;./app/models/user&#39;</span>
    <span class="nv">done = </span><span class="nx">@async</span><span class="p">()</span>
    <span class="nx">User</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">remove</span> <span class="nf">(err) -&gt;</span>
      <span class="k">if</span> <span class="nx">err</span> <span class="k">then</span> <span class="k">throw</span> <span class="nx">err</span>
      <span class="nv">users = </span><span class="p">[</span>
        <span class="nv">username: </span><span class="s">&#39;admin&#39;</span>
        <span class="nv">password: </span><span class="s">&#39;p@ssw0rd&#39;</span>
        <span class="nv">roles: </span>   <span class="p">[</span><span class="s">&#39;admin&#39;</span><span class="p">]</span>
      <span class="p">,</span>
        <span class="nv">username: </span><span class="s">&#39;user&#39;</span>
        <span class="nv">password: </span><span class="s">&#39;p@ssw0rd&#39;</span>
        <span class="nv">roles: </span>   <span class="p">[</span><span class="s">&#39;user&#39;</span><span class="p">]</span>
      <span class="p">]</span>
      <span class="nx">User</span><span class="p">.</span><span class="nx">create</span> <span class="nx">users</span><span class="p">,</span> <span class="nf">(err) -&gt;</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="k">then</span> <span class="k">throw</span> <span class="nx">err</span>
        <span class="nx">done</span><span class="p">()</span>

  <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s">&#39;default&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s">&#39;deploy-assets&#39;</span>
    <span class="s">&#39;concurrent:dev&#39;</span>
  <span class="p">])</span>

  <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s">&#39;production&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s">&#39;deploy-assets&#39;</span>
    <span class="s">&#39;uglify&#39;</span>
    <span class="s">&#39;forever:start&#39;</span>
  <span class="p">])</span>
  <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s">&#39;stop&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;forever:stop&#39;</span><span class="p">])</span>
  <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s">&#39;restart&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;deploy-assets&#39;</span><span class="p">,</span> <span class="s">&#39;uglify&#39;</span><span class="p">,</span> <span class="s">&#39;forever:stop&#39;</span><span class="p">,</span> <span class="s">&#39;forever:start&#39;</span><span class="p">])</span></div></div></div></div></body></html>